mixed-port: 7897
allow-lan: true
mode: rule
log-level: info
ipv6: false

profile:
  store-selected: true
  store-fake-ip: true

dns:
  enable: true
  listen: 0.0.0.0:53
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  nameserver:
    - https://223.5.5.5/dns-query
    - https://1.12.12.12/dns-query
  fake-ip-filter:
    - 'rule-set:fakeip-filter'

# 代理组
proxy-groups:
  - {name: 节点选择, type: select, proxies: [自动选择, 手动选择, DIRECT]}
  - {name: 自动选择, type: url-test, url: "https://cp.cloudflare.com/generate_204", interval: 300, tolerance: 100, proxies: [手动选择]}
  - {name: 手动选择, type: select, include-all: true}

  # 常用分流
  - {name: 国外媒体, type: select, proxies: [节点选择, 自动选择, DIRECT]}
  - {name: 电报信息, type: select, proxies: [节点选择, 自动选择, DIRECT]}
  - {name: 人工智能, type: select, proxies: [节点选择, 自动选择, DIRECT]}
  - {name: 苹果服务, type: select, proxies: [DIRECT, 节点选择]}
  - {name: 微软服务, type: select, proxies: [DIRECT, 节点选择]}

# 规则订阅
RuleSet_classical: &RuleSet_classical {type: http, behavior: classical, interval: 43200, format: text, proxy: 节点选择}
RuleSet_domain: &RuleSet_domain {type: http, behavior: domain, interval: 43200, format: text, proxy: 节点选择}
RuleSet_ipcidr: &RuleSet_ipcidr {type: http, behavior: ipcidr, interval: 43200, format: text, proxy: 节点选择}

rule-providers:
  fakeip-filter:
    <<: *RuleSet_domain
    url: https://testingcf.jsdelivr.net/gh/DustinWin/ruleset_geodata@mihomo-ruleset/fakeip-filter.mrs
    path: ./rules/fakeip-filter.mrs

  cn:
    <<: *RuleSet_domain
    url: https://testingcf.jsdelivr.net/gh/DustinWin/ruleset_geodata@mihomo-ruleset/cn.mrs
    path: ./rules/cn.mrs

  telegram:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/telegram.txt
    path: ./rules/telegram.txt

  stream:
    <<: *RuleSet_classical
    url: https://ruleset.skk.moe/Clash/non_ip/stream.txt
    path: ./rules/stream.txt

# 规则
rules:
  - RULE-SET,fakeip-filter,节点选择
  - RULE-SET,telegram,电报信息
  - RULE-SET,stream,国外媒体
  - RULE-SET,cn,DIRECT
  - MATCH,节点选择
